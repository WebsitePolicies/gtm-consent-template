___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "WebsitePolicies Cookie Consent Manager",
  "categories": [
    "UTILITY",
    "TAG_MANAGEMENT"
  ],
  "brand": {
    "id": "gtm_consent_template",
    "displayName": "WebsitePolicies",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "WebsitePolicies Cookie Consent Manager GTM Integration.\n\nCopy the cookie consent script URL from the installation page in your WebsitePolicies account and insert it into the \"Cookie Script URL\" field.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "wpccScriptURL",
    "displayName": "Cookie Script URL",
    "simpleValueType": true,
    "help": "Enter your WebsitePolicies cookie consent script URL."
  },
  {
    "type": "GROUP",
    "name": "Advanced",
    "displayName": "Other Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "CHECKBOX",
        "name": "wpccMicrosoftTag",
        "checkboxText": "Enable Microsoft consent mode",
        "simpleValueType": true,
        "defaultValue": false
      },
      {
        "type": "CHECKBOX",
        "name": "wpccNoScriptInject",
        "checkboxText": "Disable automation cookie consent script injection",
        "simpleValueType": true,
        "defaultValue": false
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const setDefaultConsentState = require('setDefaultConsentState');
const updateConsentState = require('updateConsentState');
const gtagSet = require('gtagSet');
const injectScript = require('injectScript');
const setInWindow = require('setInWindow');
const copyFromWindow = require('copyFromWindow');
const log = require('logToConsole');
const createQueue = require('createQueue');
const dataLayerPush = createQueue('dataLayer');

const updateMicrosoftTag = (lhs, rhs) => { 
  if ( data.wpccMicrosoftTag ) {
    require('createQueue')('uetq')('consent', 'update', {    
      'ad_storage': data.ad_storage
    });
  }
};

setDefaultConsentState({
  'ad_storage': 'denied',
  'ad_user_data': 'denied',
  'ad_personalization': 'denied',
  'analytics_storage': 'denied',
  'functionality_storage': 'granted',
  'personalization_storage': 'denied',
  'security_storage': 'granted',
  'wait_for_update': 500
});

updateMicrosoftTag();

const setConsentFromWindow = () => {
  const currentConsent = copyFromWindow('wpccGTMConsentData');
  updateConsentState(currentConsent);
  dataLayerPush({'event': 'wpcc_consent_update'});
  updateMicrosoftTag();
};

setInWindow('wpccGTMConsent', () => {
  setConsentFromWindow();
});

if ( !data.wpccNoScriptInject ) {
  injectScript(data.wpccScriptURL);
}

// Call data.gtmOnSuccess when the tag is finished.
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "uetq"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wpccGTMConsent"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wpccGTMConsentData"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "write_data_layer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keyPatterns",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "url_passthrough"
              },
              {
                "type": 1,
                "string": "ads_data_redaction"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.websitepolicies.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 12/08/2024, 15:40:09
